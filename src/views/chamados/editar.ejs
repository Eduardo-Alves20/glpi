<section class="page">
  <div class="page__top">
    <div>
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="/app">Home</a>
        <span>/</span>
        <a href="/chamados/meus">Chamados</a>
        <span>/</span>
        <strong>Editar chamado</strong>
      </nav>

      <h1 class="page__title">Editar chamado <%= chamado?.numero ? `#${chamado.numero}` : "" %></h1>
      <p class="page__subtitle">
        Status atual: <strong><%= chamado?.status || "-" %></strong>
      </p>
    </div>

    <div class="page__actions">
      <a class="btn btn--ghost" href="/chamados/meus">Voltar</a>
    </div>
  </div>

  <% if (typeof erroGeral !== "undefined" && erroGeral) { %>
    <div class="alert alert--danger"><%= erroGeral %></div>
  <% } %>

  <div class="card">
    <div class="card__header">
      <h2 class="card__title">Alterar informacoes</h2>
      <p class="card__hint">Voce so consegue editar enquanto o chamado estiver com status <strong>aberto</strong>.</p>
    </div>

    <form class="form" method="post" action="/chamados/<%= chamado?.id %>/editar" autocomplete="off" novalidate>
      <div class="form__grid">
        <div class="form__field form__field--full">
          <label class="form__label" for="titulo">Titulo</label>
          <input
            class="form__input"
            id="titulo"
            name="titulo"
            type="text"
            minlength="6"
            maxlength="120"
            required
            placeholder="Ex.: Nao consigo acessar o sistema"
            value="<%= valores?.titulo || '' %>"
            <%= bloqueado ? "disabled" : "" %>
          />
        </div>

        <div class="form__field">
          <label class="form__label" for="categoria">Categoria</label>
          <select class="form__input" id="categoria" name="categoria" required <%= bloqueado ? "disabled" : "" %>>
            <% const categorias = opcoesClassificacao?.categorias || []; %>
            <% const categoriaAtualNaoListada = valores?.categoria && !categorias.some((item) => item.value === valores.categoria); %>
            <option value="" <%= !valores?.categoria ? "selected" : "" %>>Selecione</option>
            <% if (categoriaAtualNaoListada) { %>
              <option value="<%= valores.categoria %>" selected><%= valores.categoria %></option>
            <% } %>
            <% categorias.forEach((item) => { %>
              <option value="<%= item.value %>" <%= valores?.categoria === item.value ? "selected" : "" %>><%= item.label %></option>
            <% }) %>
          </select>
        </div>

        <div class="form__field form__field--full">
          <label class="form__label" for="descricao">Descricao</label>
          <textarea
            class="form__input form__textarea"
            id="descricao"
            name="descricao"
            minlength="20"
            maxlength="5000"
            required
            rows="7"
            placeholder="Inclua: passos para reproduzir, impacto, urgencia e se ocorre sempre."
            <%= bloqueado ? "disabled" : "" %>
          ><%= valores?.descricao || "" %></textarea>
        </div>
      </div>

      <div class="form__actions">
        <% if (!bloqueado) { %>
          <button class="btn btn--primary" type="submit">Salvar alteracoes</button>
        <% } %>
        <a class="btn btn--ghost" href="/chamados/meus">Cancelar</a>
      </div>
    </form>
  </div>
</section>
