<div class="content-with-pagination-wrapper chamados-page">
  <div class="content-with-pagination">

    <%- include('../partials/breadcrumb', {
      crumbs: [
        { label: 'Home', href: '/app' },
        { label: 'Chamados', href: '/chamados/meus' },
        { label: 'Meus chamados' }
      ]
    }) %>

    <div class="page-head">
      <div>
        <h1 class="page-title">Meus chamados</h1>
        <p class="page-subtitle">Acompanhe os chamados que voce abriu.</p>

        <% if (typeof erroGeral !== 'undefined' && erroGeral) { %>
          <div class="alert-error"><%= erroGeral %></div>
        <% } %>
      </div>

      <div class="page-actions">
        <a class="btn-primary" href="/chamados/novo">Abrir chamado</a>
      </div>
    </div>

    <% if (typeof flash !== "undefined" && flash) { %>
      <script>
        window.__FLASH__ = <%- JSON.stringify({
          tipo: String(flash.tipo || "info").toLowerCase(),
          mensagem: String(flash.mensagem || "").slice(0, 300)
        }) %>;
      </script>
    <% } %>

    <%- include('../partials/chamados-filtros', {
      filtroId: 'meus-chamados',
      filtros,
      opcoes,
      totalFiltrados,
      totalBase,
      rotaLimpar: '/chamados/meus',
      mostrarCampoAlocacao: false,
      mostrarCampoResponsavelLogin: true,
    }) %>

    <div class="table-card chamados-table-card">
      <table class="table">
        <thead>
          <tr>
            <th>Titulo</th>
            <th style="width: 180px;">Solicitante</th>
            <th style="width: 140px;">Categoria</th>
            <th style="width: 140px;">Prioridade</th>
            <th style="width: 160px;">Responsavel</th>
            <th style="width: 140px;">Status</th>
            <th style="width: 190px;">Quando</th>
            <th style="width: 110px;">Acoes</th>
          </tr>
        </thead>

        <tbody>
          <% if (!chamados || chamados.length === 0) { %>
            <tr>
              <td colspan="8" class="empty-row">Nenhum chamado encontrado.</td>
            </tr>
          <% } else { %>
            <% chamados.forEach((c) => { %>
              <tr data-row-href="/chamados/<%= c.id %>">
                <td>
                  <p class="table-content">
                    <a class="table-link" href="/chamados/<%= c.id %>">
                      <%= c.titulo %>
                    </a>
                  </p>
                </td>

                <td>
                  <p class="table-content"><%= c.solicitante %></p>
                </td>

                <td>
                  <p class="table-content">
                    <span class="pill pill-muted" title="<%= c.categoriaLabel %>"><%= c.categoriaLabel %></span>
                  </p>
                </td>

                <td>
                  <p class="table-content">
                    <span class="pill pill-prio pill-prio-<%= String(c.prioridade || '').toLowerCase() %>" title="<%= c.prioridadeLabel %>">
                      <%= c.prioridadeLabel %>
                    </span>
                  </p>
                </td>

                <td>
                  <p class="table-content"><%= c.responsavel %></p>
                </td>

                <td>
                  <p class="table-content">
                    <span class="pill pill-status pill-status-<%= String(c.status || '').toLowerCase() %>" title="<%= c.statusLabel %>">
                      <%= c.statusLabel %>
                    </span>
                  </p>
                </td>

                <td>
                  <p class="table-content"><%= c.quando %></p>
                </td>

                <td>
                  <div class="btn-items">
                    <a class="small-icon" href="/chamados/<%= c.id %>" title="Abrir chamado" aria-label="Abrir chamado">
                      <img class="small-icon" src="/assets/editar.png" alt="Editar">
                    </a>
                  </div>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>

    <%- include('../partials/paginacao', {
      basePath: '/chamados/meus',
      paginacao: paginacao,
      query: paginacaoQuery || filtros,
    }) %>

  </div>
</div>
